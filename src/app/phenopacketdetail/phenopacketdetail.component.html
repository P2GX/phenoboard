@if (row) {
  <div class="phenopacket-container">
    <!-- Individual info using mat-card -->
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Individual</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="grid">
          <div><strong>ID:</strong> {{ row.individualData.individualId }}</div>
          <div><strong>Sex:</strong> {{ row.individualData.sex }}</div>
          <div><strong>Age of onset:</strong> {{ row.individualData.ageOfOnset }}</div>
          <div><strong>Age at last encounter:</strong> {{ row.individualData.ageAtLastEncounter }}</div>
          <div><strong>Deceased:</strong> {{ row.individualData.deceased }}</div>
          <div class="full"><strong>Comment:</strong> {{ row.individualData.comment }}</div>
          <div class="full"><strong>Publication:</strong>
            <a mat-button 
               [href]="'https://pubmed.ncbi.nlm.nih.gov/' + getPmidNumber(row.individualData.pmid)" 
               target="_blank"
               color="primary">
              {{ row.individualData.pmid }}
            </a>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Diseases -->
    @if (row.diseaseIdList.length) {
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title>Diseases</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-list>
            @for (diseaseId of row.diseaseIdList; track diseaseId) {
              <mat-list-item>
                <mat-icon mat-list-icon>medical_services</mat-icon>
                 @if (getOmimUrl(diseaseId)) {
                    <a [href]="getOmimUrl(diseaseId)" target="_blank">
                      {{ getDiseaseLabel(diseaseId) }}
                    </a>
                  } @else {
                    <span>
                      {{ getDiseaseLabel(diseaseId) }}
                    </span>
                  }
              </mat-list-item>
            }
          </mat-list>
        </mat-card-content>
      </mat-card>
    }

    <!-- Variants -->
    @if (row.alleleCountMap | keyvalue; as alleleCounts) {
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title>Variants</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <table>
            <thead>
              <tr>
                <th>Variant</th>
                <th>Allele Count</th>
              </tr>
            </thead>
            <tbody>
              @for (allele of alleleCounts; track $index) {
                <tr>
                  <td>{{ getVariantString(allele.key) }}</td>
                  <td>{{ allele.value }}</td>
                </tr>
            }
            </tbody>
          </table>
        </mat-card-content>
      </mat-card>
    }

    <!-- Phenotypic Features -->
    @if (observedTerms.length || excludedTerms.length) {
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title>Phenotypic Features (HPO)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (observedTerms.length) {
            <h3>Observed</h3>
            <mat-list class="hpo-observed">
              @for (h of observedTerms; track h.hpoId) {
                <mat-list-item class="hpo-item">
                  <div mat-line>
                    <a [href]="'https://hpo.jax.org/browse/term/' + h.hpoId" 
                       target="_blank" 
                       class="hpo-link">
                     {{ h.hpoLabel }} ({{ h.hpoId }})
                    </a>
                  </div>
                </mat-list-item>
              }
            </mat-list>
          }

          @if (excludedTerms.length) {
            <h3>Excluded</h3>
            <mat-list class="hpo-excluded">
              @for (h of excludedTerms; track h.hpoId) {
                <mat-list-item class="hpo-item">
                  <div mat-line>
                    <a [href]="'https://hpo.jax.org/browse/term/' + h.hpoId" 
                       target="_blank" 
                       class="hpo-link">
                     {{ h.hpoLabel }} ({{ h.hpoId }})
                    </a>
                  </div>
                </mat-list-item>
              }
            </mat-list>
          }
        </mat-card-content>
      </mat-card>
    }
  </div>
} @else {
  <mat-card>
    <mat-card-content>
      <p>Phenopacket not found.</p>
    </mat-card-content>
  </mat-card>
}