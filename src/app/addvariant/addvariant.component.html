<p class="text-xs text-gray-500 mt-2">
    This dialog supports 
    @if (!isStructural()) { standard HGVS variant formats and }
    unvalidated (symbolic) structural variant descriptions.
    @if (!isStructural()) {
        For more information, visit
        <a href="#" (click)="openHgvs($event)" class="text-blue-600 underline">the HGVS website</a>. 
        <a href="#" (click)="openVariantValidator($event)" class="text-blue-600 underline">Variant Validator</a> 
        is used for validation.
    }
</p>

<mat-card class="p-4">
    <mat-card-title class="text-lg mb-4">Variant Entry</mat-card-title>

    <div class="flex flex-col md:flex-row gap-4">
        <mat-form-field appearance="fill" class="w-full md:flex-1">
            <mat-label>Variant</mat-label>
            <input matInput [(ngModel)]="variant_string" 
                    (input)="onVariantInput()" 
                    [disabled]="variantValidated" 
                    autofocus
                    autocapitalize="none"
                    spellcheck="false"
                    autocomplete="off" />
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-full md:flex-1">
            <mat-label>Gene</mat-label>
            <mat-select [(ngModel)]="selectedGene" [disabled]="variantValidated">
                @for (gene of geneOptions; track gene.geneSymbol) {
                    <mat-option [value]="gene">{{ gene.geneSymbol }}</mat-option>
                }
            </mat-select>
        </mat-form-field>

        @if (isStructural()) {
            <mat-form-field appearance="fill" class="w-full md:flex-1">
                <mat-label>Structural Variant Type</mat-label>
                <mat-select [(ngModel)]="selectedStructuralType" [disabled]="variantValidated">
                    @for (type of structuralTypes; track type.label) {
                        <mat-option [value]="type">{{ type.label }}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        }
    </div>

    <div class="mt-6 flex flex-col md:flex-row md:items-center justify-between gap-4">
        
        <div class="flex gap-4 items-center">
            @if (!variantValidated) {
                <button mat-raised-button color="accent" (click)="submit()" 
                        [disabled]="!selectedGene || isSubmitting">
                    {{ isSubmitting ? 'Validating...' : getSubmitLabel() }}
                </button>
            } @else {
                <button mat-raised-button color="primary" (click)="addVariantToPpkt()">
                    Add variant to case
                </button>
                
                <mat-checkbox [(ngModel)]="isBiallelic" color="primary">
                    Biallelic
                </mat-checkbox>

                <button mat-button (click)="resetVars()" class="text-gray-500">
                    Edit Variant
                </button>
            }
            
            <button mat-raised-button color="warn" (click)="cancel()">Cancel</button>
        </div>

        <div class="flex items-center gap-2">
            @if (variantValidated) {
                <span class="inline-block w-3 h-3 rounded-full bg-green-500"></span>
                <span class="text-green-600 text-sm font-medium">{{ validationMessage || 'Validated' }}</span>
            }
            
            @if (errorMessage) {
                <mat-error class="text-sm">{{ errorMessage }}</mat-error>
            }
        </div>
    </div>
</mat-card>