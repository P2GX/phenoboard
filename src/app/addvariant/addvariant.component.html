<!-- Modal dialog for entering and validating a new variant. -->

<p class="text-xs text-gray-500 mt-2">
    This dialog supports standard HGVS variant formats and unvalidated (symbolic) structural variant descriptions. 
    For more information, visit
    <a href="#"  (click)="openHgvs($event)" class="text-blue-600 underline">the HGVS website</a>. 
    <a href="#" (click)="openVariantValidator($event)" class="test-blue-600 underline">Variant Validator</a> 
    is used for validation of HGVS variants.
</p>

<mat-card class="p-4">
<mat-card-title class="text-lg mb-4">Variant Entry</mat-card-title>

<div class="flex flex-col md:flex-row gap-4">
    <mat-form-field appearance="fill" class="w-full md:flex-1">
    <mat-label>Variant</mat-label>
        <input
            matInput
            [(ngModel)]="variant_string"
            (input)="onVariantInput()"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
        />
    </mat-form-field>
    <!-- Gene Dropdown -->
    <mat-form-field appearance="fill" class="w-full md:flex-1">
        <mat-label>Gene</mat-label>
        <mat-select [(ngModel)]="selectedGene">
            @for (gene of geneOptions; track gene) {
                <mat-option [value]="gene">{{ gene.geneSymbol }}</mat-option>
            }
        </mat-select>
    </mat-form-field>
    <!-- Structural Variant Dropdown (only show for non-HGVS) -->
     @if (!isHgvs) {
        <mat-form-field appearance="fill" class="w-full md:flex-1">
            <mat-label>Structural Variant Type</mat-label>
            <mat-select [(ngModel)]="selectedStructuralType">
                @for (type of structuralTypes; track type) {
                    <mat-option [value]="type">{{ type.label }}</mat-option>
                }
            </mat-select>
        </mat-form-field>
    }
</div>

<!-- Buttons + Validation Indicator -->
<div class="mt-6 flex flex-col md:flex-row md:items-center gap-4">

    <div class="mt-6 flex flex-col md:flex-row md:items-center gap-4">
        @if (!validationComplete) {
            <div class="flex gap-4">
                @if (isHgvs && !variantValidated){
                    <button
                        mat-raised-button
                        color="primary"
                        (click)="submitHgvsDto()"
                        [disabled]="!selectedGene || isSubmitting"
                    >
                        Submit HGVS
                    </button>
                } @else if (!variantValidated) {
                    <button
                        mat-raised-button
                        color="accent"
                        (click)="submitSvDto()"
                        [disabled]="!selectedGene || !selectedStructuralType || isSubmitting"
                    >Submit SV
                    </button>
                    
                }
                <button mat-raised-button color="warn" (click)="cancel()">Cancel</button>
            </div>
        } 
        
        @if(variantValidated) {
            <!-- i.e., validation is complete. -->
            <div class="flex gap-4">
                <button mat-raised-button color="primary" 
                        (click)="addVariantToPpkt()" 
                        [disabled]="!variantValidated">Add variant to case</button>
                <button mat-raised-button color="warn" (click)="cancel()">Cancel</button>
            </div>
        }

    <!-- Validation Status -->
    @if (validationMessage) {
        <div class="flex items-center gap-2">
            @if (variantValidated){
                <span class="inline-block w-3 h-3 rounded-full bg-green-500"></span>
            }
            <span class="text-sm" [ngClass]="{'text-green-600': variantValidated, 'text-red-600': !variantValidated}">
                {{ validationMessage }}
            </span>
        </div>
        }
    </div>

    @if (variantValidated){
        <div class="flex items-center gap-2">
            <span class="inline-block w-3 h-3 rounded-full bg-green-500"></span>
            <span class="text-green-600 text-sm">Variant validated</span>
        </div>
    }
    </div>

     @if (errorMessage){
        <mat-error class="block text-sm mt-4">
        {{ errorMessage }}
        </mat-error>
    }
</mat-card>
