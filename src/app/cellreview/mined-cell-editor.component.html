<div class="mined-cell-container">
  <div class="cell-header">
    <div class="flex items-center gap-2 mb-3">
      <mat-icon class="text-slate-400">subject</mat-icon>
      <span class="text-xs uppercase tracking-wider font-semibold text-slate-500">Source Evidence</span>
    </div>
    <div class="source-bubble">
      "{{ cell().cellText }}"
    </div>
  </div>

  <table class="compact-table">
    <thead>
      <tr>
        <th>HPO Terminology</th>
        <th>Identifier</th>
        <th class="text-right">Configuration</th>
      </tr>
    </thead>
    <tbody>
      @for (term of cell().mappedTermList; track term.hpoId) {
      <tr>
        <td class="term-label">
          <strong>{{ term.hpoLabel || 'Unknown Term' }}</strong>
        </td>
        <td>
          <span class="hpo-id-badge">{{ term.hpoId }}</span>
        </td>
        <td class="action-col">
          <div class="controls-wrapper">
            <button mat-stroked-button [matMenuTriggerFor]="statusMenu" class="status-btn" 
                    [class.status-set]="term.status">
              <span class="btn-label">Status:</span>
              <span class="current-value">{{ (term.status || 'na') | titlecase }}</span>
              <mat-icon>arrow_drop_down</mat-icon>
            </button>

            <div class="onset-group" [class.has-onset]="term.onset && term.onset !== 'na'">
              <div class="onset-icon">
                <mat-icon>schedule</mat-icon>
              </div>
              <select #onsetSelect (change)="updateOnset(term, onsetSelect.value)" class="onset-select">
                @for (option of availableOnsetTerms; track option) {  
                  <option [value]="option" [selected]="option === term.onset">{{ option }}</option>
                }
              </select>
              <button (click)="addOnsetString(term)" class="add-onset-btn" matTooltip="Add Custom Onset">+</button>
            </div>
          </div>

          <mat-menu #statusMenu="matMenu">
            @for (opt of statusOptions; track opt) {
              <button mat-menu-item (click)="updateStatus(term, opt)">
                <mat-icon [color]="term.status === opt ? 'primary' : ''">
                  {{ term.status === opt ? 'check_circle' : 'radio_button_unchecked' }}
                </mat-icon>
                <span>{{ opt | titlecase }}</span>
              </button>
            }
          </mat-menu>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>