<mat-dialog-content class="mat-typography">
  <div class="review-table-container">
    <table class="custom-curation-table">
      <thead>
        <tr>
          <th class="w-[30%]">Source Fragment</th>
          <th class="w-[55%]">HPO Mappings</th>
          <th class="w-[15%] text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (c of concepts(); track $index; let i = $index) {
          <tr [class.is-confirmed]="c.miningStatus === 'confirmed'">
            
            <td class="col-source">
              <div class="flex items-start gap-2">
                <mat-icon class="text-gray-400 scale-75 mt-1">description</mat-icon>
                <code class="source-code">"{{ c.originalText }}"</code>
                <button mat-icon-button color="primary" class="split-btn" (click)="openSplitDialog(i)">
                  <mat-icon>content_cut</mat-icon>
                </button>
              </div>
            </td>

            <td class="col-mapping">
              <div class="flex flex-wrap gap-2 items-center">
                @for (term of c.suggestedTerms; track $index; let termIdx = $index) {
                  <mat-chip-row (removed)="removeTerm(i, termIdx)" class="hpo-chip">
                    <span class="font-mono font-bold mr-1 opacity-70">{{ term.id }}</span>
                    <span>{{ term.label }}</span>
                    <button matChipRemove><mat-icon>cancel</mat-icon></button>
                  </mat-chip-row>
                }

                @if (searchingIndices.has(i) || c.suggestedTerms.length === 0) {
                  <app-hpoautocomplete class="flex-grow" (selected)="addNewTerm(i, $event)"></app-hpoautocomplete>
                } @else {
                  <button mat-icon-button (click)="startSearch(i)" class="add-btn">
                    <mat-icon>add_circle_outline</mat-icon>
                  </button>
                }
              </div>
            </td>

            <td class="col-actions">
              <div class="flex justify-end gap-1">
                <button mat-icon-button (click)="toggleConfirm(i)" [color]="c.miningStatus === 'confirmed' ? 'primary' : ''">
                  <mat-icon>{{ c.miningStatus === 'confirmed' ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="removeConcept(i)">
                  <mat-icon>delete_outline</mat-icon>
                </button>
              </div>
            </td>

          </tr>
        }
      </tbody>
    </table>
    
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end" class="p-4 border-t bg-gray-50">
  <button mat-button class="btn-outline-cancel" (click)="cancel()">Discard Changes</button>
  <button mat-raised-button color="primary" class="btn-outline-primary" (click)="save()" [disabled]="concepts().length === 0">
    <mat-icon class="mr-1">done_all</mat-icon>
    Apply {{ concepts().length }} Mappings
  </button>
</mat-dialog-actions>