<div class="w-full px-[5%]"><app-pubmed #pmidChild></app-pubmed>
<app-addages #addagesComponent (ageEntries)="handleAgeList($event)" *ngIf="showAgeEntryArea"></app-addages>
<app-adddemo #adddemoComponent (dataEnteredChange)="handleDemographicData($event)"></app-adddemo>
<div class="w-full mx-auto p-4">
  <div *ngIf="showTextArea">
  <label class="block mb-2 text-sm font-medium text-gray-700">
      Paste clinical text
  </label>
  <div class="flex flex-col items-start">
    <textarea
      [(ngModel)]="pastedText"
      rows="20"
      placeholder="Paste here with ctrl-V..."
      class="w-[100%] border-4 border-gray-400 rounded-md p-3 text-sm font-mono resize-y focus:outline-none focus:border-blue-500"
    ></textarea>

    <button
      (click)="doHpoTextMining()"
      class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
    >Run HPO Text Mining</button>
</div>
</div>
</div>
<div *ngIf="showDataEntryArea">
  <button
    class="text-sm px-3 py-1 bg-gray-200 hover:bg-gray-300 w-full text-left"
    (click)="showCollapsed = !showCollapsed"
  >
    {{ showCollapsed ? '▼' : '►' }} Show Data Entry
  </button>
   <div *ngIf="showCollapsed" class="p-2 space-y-2">
      <div class="whitespace-pre-wrap text-sm font-mono mb-4"
        [innerHTML]="htmlData"
        (mouseup)="handleTextSelection($event)"
        ></div>
        
      <div *ngIf="selectedText" class="mt-2">
        <span class="text-green-600 font-bold">Selected: "{{ selectedText }}"</span>
        <button (click)="annotateSelectedText()" class="ml-2 px-3 py-1 bg-blue-500 text-white rounded">Annotate</button>
      </div> 

      <div
        *ngIf="showAnnotationPopup"
        class="absolute bg-white border rounded shadow p-2 z-50"
        [style.top.px]="popupY"
        [style.left.px]="popupX"
      >
        <div class="text-sm font-medium mb-1">Annotate selection</div>
        <button
          *ngFor="let option of rightClickOptions"
          class="block w-full text-left"
          (click)="annotateSelection(option)"
        >
          {{ option }}
        </button>
        <button class="block w-full text-left" (click)="closePopup()">Cancel</button>
      </div>
    </div>
    <div *ngIf="showAnnotationPopup" [style.left.px]="popupX" [style.top.px]="popupY" class="annotation-popup">
  <h4>Annotation Details</h4>
  <p><strong>Label:</strong> {{ selectedAnnotation?.label }}</p>
  <p><strong>Term ID:</strong> {{ selectedAnnotation?.termId }}</p>
  <p><strong>Observed:</strong> {{ selectedAnnotation?.isFenominalHit ? 'Yes' : 'No'  }}</p>
  <p><strong>Onset:</strong> {{ selectedAnnotation?.onsetString || '(none)' }}</p>
  
  <!-- Optional: add editing here if you want -->
  <!--
  <label>Onset:
    <input [(ngModel)]="selectedAnnotation.onsetString" />
  </label>
  -->

  <button (click)="closePopup()">Close</button>
</div>
  </div>

<pre class="whitespace-pre-wrap text-sm font-mono mb-4">{{ htmlData }}</pre>
<div class="flex gap-2 mt-3">
  

  <button
    (click)="submitAnnotations()"
    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition"
  >
    Submit
  </button>
  <button
    (click)="resetWindow()"
    class="px-4 py-2 bg-gray-200 text-black rounded-md hover:bg-blue-100 transition"
  >
    Reset
  </button>
</div>
<div *ngIf="showAnnotations" class="mt-4 p-2 border rounded bg-gray-50">
  <strong>Annotated Terms:</strong>
  <ul class="list-disc list-inside text-sm text-gray-700">
    <li *ngFor="let term of uniqueAnnotatedTerms">{{ term }}</li>
  </ul>
</div>

<!-- <p *ngIf="pastedText">Original text: {{ pastedText }}</p> -->

<!-- Display the table if jsonData is available -->
<table *ngIf="jsonData.length">
  <thead>
    <tr>
      <!-- Create table headers dynamically -->
      <th *ngFor="let key of getObjectKeys(jsonData[0])">{{ key }}</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of jsonData; let i = index" [ngClass]="{'highlight': item.status === 'active'}">
      <td *ngFor="let key of getObjectKeys(item)">
        {{ item[key] }}
      </td>
      <!-- New Column with Radio Buttons and Input -->
      <td>
        <div *ngFor="let option of predefinedOptions">
          <input type="radio" [name]="'option_' + i" [(ngModel)]="selectedOptions[i]" [value]="option">
          {{ option }}
        </div>

        <!-- Input Field for Custom Option -->
        <input type="text" [(ngModel)]="customOptions[i]" placeholder="Enter custom option">
        <button (click)="addCustomOption(i)">Add</button>
      </td>
    </tr>
  </tbody>
</table>

<p>Selected Options: {{ selectedOptions | json }}</p>



</div>